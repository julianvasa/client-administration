# Client administration application


## What is it about?
Here we have a small web application allowing to manage clients. The following features have been implemented: 
- A RESTful API to handle client data
- Edit first name, last name, telephone number, email address and postal address fields (street, postal code, city and country)
- It supports all CRUD functionalities
- It validates input data
- It's backed by a persistence layer (postgres db)
- It allows to activate and deactivate clients
- The “List Clients” endpoint can be queried by last name, postal code, city and/or country
    - It doesn't show deactivated clients
- The “List Clients” endpoint is paginated
- It has an authentication and access control to access the endpoints
- It allows adding new users (currently all users have same / all rights control)
- Every change on the resource is audited in the DB (TODO: expose audit tables in a rest endpoint)
- High flexible solution due to the high integration with spring-data-rest
- Docker integration
- Tests (unit, integration)

## Solution

The application is very simple, it has one Resource (entity) "Client" which is exposed as a Rest Resource through spring-data-rest library. 
The application has security restricted access to the resouce operation. 
The application exposes an endpoint /users/sign-up that allows user creation 
and one endpoint /login that authenticates the user before performing any request and returns a JWT token
The JWT token is used in the header of the next request so that the server can authorize the user to perform some operation on the resource "Client".

The provided stack: Spring Boot (web), Spring Data Jpa, Spring Data Rest, Spring Security, Postgres DB, Spring Data Envers (auditing)  

## How to start 

Installs the necessary dependencies to make the application work and create a single fat jar that can be run in the command line:

```mvn install package```  (run tests automatically)

The server listens on port 8080: http://localhost:8080 

#### Client Model structure
    {
        "id"            : <number>, (autogenerated)
        "firstName"     : <string>, regex validation: ^[a-zA-Z]*$
        "lastName"      : <string>, regex validation: ^[a-zA-Z]*$
        "email"         : <string>, hibernate email validation
        "address"       : <Address>,
        "deactivated"   : <boolean>,
        "country"       : <string>,
        "phone"         : <string>  regex validation: ^[0-9+]*$
        "audit"         : <Audit>
    }
    
#### Address Model structure
    {
        "id"            : <number>, (autogenerated)
        "street"        : <string> 
        "city"          : <string>
        "country"          : <string>
        "zip"           : <number>
    }

#### ApplicationUser Model structure
    {
        "id"            : <number>, (autogenerated)
        "username"      : <string> 
        "password"      : <string>
    }
        
#### Create a new user through rest api
    POST /users/sign-up
    {
        "username": "test",
        "password": "12345678"
    }

Example response:

    HTTP 200 OK
    
#### Login

    POST /login
        {
            "username": "test",
            "password": "12345678"
        }   
    
In the response header there is a field 

`Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJqdWxpdXMiLCJleHAiOjE1NzQ5NzQzMjd9.map7uMUItdOXrQvR8rxrOxBi6xU2Guc3Ns5WfgTFPTS4HWLBe_tfqqOJc5Bc_CunF6MzE6IcE6ILIX-eHaCknA    
`

With this token can be performed GET, POST, PUT, DELETE requests on the "Client" resource

#### Get a list of all clients (active)

`GET http://localhost:8080/api/clients
`

Respose is something like this

    {
      "_embedded": {
        "clients": [
          {
            "firstName": "test",
            "lastName": "test",
            "email": "test@test.com",
            "phone": "1213123213",
            "deactivated": false,
            "address": {
              "street": "My address",
              "city": "Tirane",
              "country": "Albania",
              "zip": 0
            },
            "audit": {
              "createdOn": "2019-11-15T02:37:23.857973",
              "createdBy": "test",
              "updatedOn": null,
              "updatedBy": null
            },
            "_links": {
              "self": {
                "href": "http://localhost:8080/api/clients/2"
              },
              "client": {
                "href": "http://localhost:8080/api/clients/2"
              }
            }
          }
        ]
      },
      "_links": {
        "self": {
          "href": "http://localhost:8080/api/clients{?page,size,sort}",
          "templated": true
        },
        "profile": {
          "href": "http://localhost:8080/api/profile/clients"
        },
        "search": {
          "href": "http://localhost:8080/api/clients/search"
        }
      },
      "page": {
        "size": 20,
        "totalElements": 1,
        "totalPages": 1,
        "number": 0
      }
    } 
 

#### Create a new client 
    POST /api/clients
    {
        "firstName": "test",
        "lastName": "test",
        "email": "test@gmail.com",
        "address": {
            "street": "Street",
            "city": "City",
            "country": "Country",
            "zip": 8888
        },
        "phone": "12223123123123"
    }
    
Response

    POST /api/clients 201 CREATED
    {
      "firstName": "test",
      "lastName": "test",
      "email": "test@gmail.com",
      "phone": "12223123123123",
      "deactivated": false,
      "address": {
        "street": "Street",
        "city": "City",
        "country": "Country",
        "zip": 8888
      },
      "audit": {
        "createdOn": "2019-11-19T08:06:02.168146",
        "createdBy": "test",
        "updatedOn": null,
        "updatedBy": null
      },
      "_links": {
        "self": {
          "href": "http://localhost:8080/api/clients/6"
        },
        "client": {
          "href": "http://localhost:8080/api/clients/6"
        }
      }
    }


#### Get a single client  
    GET /api/clients/2
    
Response

    GET /api/clients/2 200 OK
    {
      "firstName": "asdasdasd",
      "lastName": "Last",
      "email": "test@test.com",
      "phone": "1213123213",
      "deactivated": false,
      "address": {
        "street": "My address",
        "city": "Tirane",
        "country": "Albania",
        "zip": 0
      },
      "audit": {
        "createdOn": "2019-11-15T02:37:23.857973",
        "createdBy": "test",
        "updatedOn": null,
        "updatedBy": null
      },
      "_links": {
        "self": {
          "href": "http://localhost:8080/api/clients/2"
        },
        "client": {
          "href": "http://localhost:8080/api/clients/2"
        }
      }
    }


#### Activated / Deactivate a client 
    PATCH /api/clients/2
    {
        "deactivated": true/false
    }
    
Response

    PATCH /api/clients/2 200 OK
    {
      "firstName": "asdasdasd",
      "lastName": "Last",
      "email": "test@test.com",
      "phone": "1213123213",
      "deactivated": true,
      "address": {
        "street": "My address",
        "city": "Tirane",
        "country": "Albania",
        "zip": 0
      },
      "audit": {
        "createdOn": "2019-11-15T02:37:23.857973",
        "createdBy": "test",
        "updatedOn": "2019-11-19T08:09:45.639184",
        "updatedBy": "test"
      },
      "_links": {
        "self": {
          "href": "http://localhost:8080/api/clients/2"
        },
        "client": {
          "href": "http://localhost:8080/api/clients/2"
        }
      }
    }
    
    
#### Update a client data 
    PUT /api/clients/2
    {
        "firstName": "changed",
        "lastName": "test",
        "email": "test@gmail.com",
        "address": {
            "street": "Street",
            "city": "City",
            "country": "Country",
            "zip": 8888
        },
        "phone": "12223123123123"
    }
    
Response

    PUT /api/clients/2 200 OK
    {
      "firstName": "changed",
      "lastName": "test",
      "email": "test@gmail.com",
      "phone": "12223123123123",
      "deactivated": false,
      "address": {
        "street": "Street",
        "city": "City",
        "country": "Country",
        "zip": 8888
      },
      "audit": {
        "createdOn": null,
        "createdBy": null,
        "updatedOn": "2019-11-19T08:11:58.033445",
        "updatedBy": "test"
      },
      "_links": {
        "self": {
          "href": "http://localhost:8080/api/clients/2"
        },
        "client": {
          "href": "http://localhost:8080/api/clients/2"
        }
      }
    }
    
    

#### Delete client  
    DELETE /api/clients/2
    
Response

    DELETE /api/clients/2 204 NO CONTENT
  
#### Search endpoints are listed below   
    {
      "_links": {
        "byCity": {
          "href": "http://localhost:8080/api/clients/search/byCity{?city,page,size,sort}",
          "templated": true
        },
        "byLastName": {
          "href": "http://localhost:8080/api/clients/search/byLastName{?lastname,page,size,sort}",
          "templated": true
        },
        "byCountry": {
          "href": "http://localhost:8080/api/clients/search/byCountry{?country,page,size,sort}",
          "templated": true
        },
        "byZipCode": {
          "href": "http://localhost:8080/api/clients/search/byZipCode{?zip,page,size,sort}",
          "templated": true
        },
        "byCityAndCountry": {
          "href": "http://localhost:8080/api/clients/search/byCityAndCountry{?city,country,page,size,sort}",
          "templated": true
        },
        "self": {
          "href": "http://localhost:8080/api/clients/search"
        }
      }
    }
